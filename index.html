<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>Проверка доступа к сайту</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <meta name="color-scheme" content="dark">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">

  <style>
    :root{
      --bg: rgb(13 17 23);
      --fg: #ffffff;
      --ring: #ffffff;
      --error: #ff3b3b;
      --radius: 8px;
      --radius-sm: 6px;
      --t-fast: .2s;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      min-height:100dvh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;
    }
    .title{margin:0 0 20px;font-weight:600;line-height:1.35}
    .wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:10px;padding:16px}
    #flagTarget{margin-bottom:20px}
    .sample{
      border:2px solid var(--ring);border-radius:var(--radius);
      transform:rotate(.5turn);display:inline-block;vertical-align:middle
    }
    #flagOptions{display:flex;gap:15px;flex-wrap:wrap;justify-content:center}
    #flagOptions img.option{
      width:70px;height:48px;cursor:pointer;border-radius:var(--radius-sm);border:2px solid transparent;
      transition: transform var(--t-fast), border-color var(--t-fast);will-change: transform;
    }
    #flagOptions img.option:hover{transform:scale(1.05)}
    @keyframes border-blink{
      0%{border-color:transparent}
      10%{border-color:var(--error)}
      90%{border-color:var(--error)}
      100%{border-color:transparent}
    }
    .wrong{animation:border-blink .6s linear 1}
  </style>
</head>
<body>
  <div class="wrap" data-captcha="flags">
    <h2 class="title">
      Докажи, что ты не бот.<br>
      Выбери картинку, которая совпадает с образцом флага:
    </h2>

    <div id="flagTarget" aria-live="polite"></div>
    <p>Выбери из вариантов ниже:</p>
    <div id="flagOptions"></div>
  </div>

  <noscript>Чтобы продолжить, включи JavaScript в настройках браузера.</noscript>

  <script>
    // Утилиты оставлены легкими и уникальными по именам
    const pickSecureIndex = (limit) => {
      if (window.crypto && window.crypto.getRandomValues) {
        const buf = new Uint32Array(1);
        window.crypto.getRandomValues(buf);
        return buf[0] % limit;
      }
      return Math.floor(Math.random() * limit);
    };

    const shuffledCopy = (arr) => {
      const out = arr.slice();
      for (let i = out.length - 1; i > 0; i--) {
        const j = pickSecureIndex(i + 1);
        [out[i], out[j]] = [out[j], out[i]];
      }
      return out;
    };

    document.addEventListener("DOMContentLoaded", () => {
      const FLAGS = [
        { name: "canada",      src: "assets/flags/canada.png" },
        { name: "uk",          src: "assets/flags/uk.png" },
        { name: "moldova",     src: "assets/flags/moldova.png" },
        { name: "south_korea", src: "assets/flags/south_korea.png" },
        { name: "japan",       src: "assets/flags/japan.png" },
        { name: "germany",     src: "assets/flags/germany.png" }
      ];

      const targetEl = document.getElementById("flagTarget");
      const optionsEl = document.getElementById("flagOptions");

      // Выбираем правильный флаг и показываем образец
      const correct = FLAGS[pickSecureIndex(FLAGS.length)];

      const sample = document.createElement("img");
      sample.className = "sample";
      sample.src = correct.src;
      sample.alt = "Образец флага";
      sample.width = 110;
      sample.height = 70;
      sample.decoding = "async";
      sample.loading = "eager";
      targetEl.appendChild(sample);

      // Рисуем варианты
      for (const flag of shuffledCopy(FLAGS)) {
        const img = document.createElement("img");
        img.className = "option";
        img.src = flag.src;
        img.alt = "Вариант флага";
        img.decoding = "async";
        img.loading = "lazy";

        img.addEventListener("click", () => {
          if (flag.name === correct.name) {
            window.location.href = "https://v2raytunvpn.me/home.html";
          } else {
            img.classList.remove("wrong");
            void img.offsetWidth;
            img.classList.add("wrong");
          }
        });

        optionsEl.appendChild(img);
      }
    });
  </script>
</body>
  <!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function(m,e,t,r,i,k,a){
        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)
    })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=105798698', 'ym');

    ym(105798698, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true});
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/105798698" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
</html>
